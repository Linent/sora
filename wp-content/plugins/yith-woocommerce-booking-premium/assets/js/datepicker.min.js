jQuery(function(m){"use strict";m.fn.yith_wcbk_datepicker=function(){var u={message:null,overlayCSS:{background:"#fff",opacity:.7},ignoreIfBlocked:!0},t=new Date,k=new Date(t.getFullYear(),t.getMonth(),t.getDate()),p=function(t){var a=t.data("type"),e=m(t.data("related-from"));return"to"===a&&0<e.length&&(t=e),t},h=function(t){return{all_day:(t=p(t)).data("all-day"),allow_same_date:t.data("allow-same-date")||"yes",ajax_load_months:t.data("ajax-load-months"),month_to_load:t.data("month-to-load"),year_to_load:t.data("year-to-load"),min_duration:t.data("min-duration"),notAvailableDates:t.data("not-available-dates")||[],product_id:t.data("product-id"),"static":t.data("static")||"no"}};return m(this).each(function(){var n=m(this),l=n.data("type"),t=n.data("min-date"),a=n.data("max-date"),c=m(n.data("related-to")),e=m(n.data("on-select-open")),r=m(n.data("related-from")),o=n.next(".yith-wcbk-date-picker--formatted"),d=m(n.data("update-on-change")),s=function(){var e=h(n),o=p(n);m("#ui-datepicker-div").block(u),m.ajax({type:"POST",data:{product_id:e.product_id,month_to_load:e.month_to_load,year_to_load:e.year_to_load,action:"yith_wcbk_get_product_not_available_dates"},url:bk.ajaxurl,success:function(t){try{t.error?console.log(t.error):(o.data("month-to-load",t.month_to_load),o.data("year-to-load",t.year_to_load),o.data("not-available-dates",e.notAvailableDates.concat(t.not_available_dates)),m("#ui-datepicker-div").unblock(),n.datepicker("refresh"))}catch(a){console.log(a.message)}}})},i=function(t,a){a=a||0;var e,o,d=h(n);0<c.length&&(o="yes"===bk.settings.check_min_max_duration_in_calendar?d.min_duration:1,"yes"===d.allow_same_date&&--o,e=0<o?yith_wcbk_dates.add_days_to_date(t,o):t,c.val()&&yith_wcbk_dates.date_diff(c.val(),e)<0&&c.datepicker("setDate",null),a?setTimeout(function(){c.datepicker("option","minDate",e)},a):c.datepicker("option","minDate",e))};n.on("yith_wcbk_datepicker_load_non_available_dates",function(t,a){var e=h(n),o=p(n);m.ajax({type:"POST",data:{product_id:e.product_id,action:"yith_wcbk_get_product_not_available_dates"},url:bk.ajaxurl,success:function(t){try{t.error?console.log(t.error):(o.data("month-to-load",t.month_to_load),o.data("year-to-load",t.year_to_load),o.data("not-available-dates",t.not_available_dates),n.datepicker("refresh"))}catch(a){console.log(a.message)}},complete:function(){"undefined"!=typeof a.callback&&a.callback()}})}),n.datepicker({dateFormat:"yy-mm-dd",minDate:t,maxDate:a,showAnim:!1,showButtonPanel:!0,closeText:yith_wcbk_datepicker_params.i18n_clear,altField:o,altFormat:bk.settings.datepickerFormat,popup:{position:"bottom left",origin:"top left"},beforeShow:function(t,a){n.addClass("yith-wcbk-datepicker--opened"),m("#ui-datepicker-div").addClass("yith-wcbk-datepicker"),"yes"===h(n)["static"]&&m("#ui-datepicker-div").addClass("yith-wcbk-datepicker--static").appendTo(n.parent().parent()),a.yith_booking_date_selected=!1,setTimeout(function(){m(".ui-datepicker-close").on("click",function(t){n.datepicker("setDate",null).trigger("change")})},10)},beforeShowDay:function(t){var a,e=!0,o=n.data("allowed-days")||[],d=h(n),i=[];return 15!==t.getDate()||function(t,a,e){e=h(n=e);if("yes"===e.ajax_load_months){a=t+"-"+a+"-01",e=e.year_to_load+"-"+e.month_to_load+"-01";if(yith_wcbk_dates.date_diff(a,e,"months")<1)return!0}return!1}(t.getFullYear(),t.getMonth()+1,n)&&s(),0<o.length&&(0===(a=t.getDay())&&(a=7),e=-1!==o.indexOf(a.toString())),e&&0<d.notAvailableDates.length&&(a="yes"===bk.settings.check_min_max_duration_in_calendar?d.min_duration:1,"yes"===d.all_day&&--a,a="to"===l?yith_wcbk_dates.add_days_to_date(t,-a):t,a=m.datepicker.formatDate("yy-mm-dd",a),e=-1===d.notAvailableDates.indexOf(a)),!e&&t.getTime()>k.getTime()&&i.push("bk-non-available-date"),"from"===l&&c.length&&m.datepicker.formatDate("yy-mm-dd",t)===c.val()&&i.push("bk-to-date"),"to"===l&&r.length&&m.datepicker.formatDate("yy-mm-dd",t)===r.val()&&i.push("bk-from-date"),[e,i.join(" ")]},onClose:function(t,a){m("#ui-datepicker-div").removeClass("yith-wcbk-datepicker"),"yes"===h(n)["static"]&&m("#ui-datepicker-div").removeClass("yith-wcbk-datepicker--static").appendTo(m("body")),a.yith_booking_date_selected&&0<e.length&&!e.val()&&(e.trigger("focus"),setTimeout(function(){e.trigger("focus")},50)),n.removeClass("yith-wcbk-datepicker--opened")},onSelect:function(t,a){t&&(i(t),a.yith_booking_date_selected=!0),m(this).trigger("change")}}),o.on("focus",function(){n.trigger("focus")});var o=n.parent().find(".yith-wcbk-booking-date-icon"),_=!1;o.on("mousedown",function(t){_=!!n.datepicker("widget").is(":visible")}).on("click",function(){_||n.trigger("focus")}),n.is(".yith-wcbk-date-picker--inline")&&n.val(n.data("value")),n.val()&&(n.datepicker("setDate",n.val()+" 00:00:00"),i(n.val(),100)),d.length&&(n.on("change",function(){d.val(m(this).val())}),d.val(n.val()))})}});