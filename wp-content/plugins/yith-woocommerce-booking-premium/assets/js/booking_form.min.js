jQuery(function(D){"use strict";D.fn.yith_wcbk_serializeFormJSON=function(){var t={},i=this.serializeArray();return D.each(i,function(){t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},D.fn.yith_booking_form=function(){var l=D(this).closest(".yith-wcbk-booking-form"),b=l.data("product-id"),g=l.data("booking_data"),u=l.find(".yith-wcbk-booking-duration"),k=0<u.length,p=l.find(".yith-wcbk-booking-persons"),f=(p.length,"hour"===g.duration_unit||"minute"===g.duration_unit),y=l.find(".yith-wcbk-booking-person-types"),w=0<y.length,v=l.find("input[type=checkbox].yith-wcbk-booking-service"),x=0<v.length,M=l.find("input.yith-wcbk-booking-service-quantity"),C=l.find(".yith-wcbk-booking-start-date"),S=l.find(".yith-wcbk-booking-hidden-from"),j=l.find(".yith-wcbk-booking-end-date"),q=l.find(".yith-wcbk-booking-form-message"),I=l.find(".yith-wcbk-booking-form-totals"),A=l.find(".yith-wcbk-booking-form-additional-data"),F={messages:[],addMessage:function(t){this.messages.push(t)},getMessages:function(t){var i=this.messages;return(t=t||1)&&this.resetMessages(),i},resetMessages:function(){this.messages=[]},hasMessages:function(){return!!this.messages.length},showAll:function(){for(var t=this.getMessages(),i="",e=0;t[e];e++)i+=t[e];q.html(i)},showFirst:function(){var t=this.getMessages(0),i="";0<t.length&&(i=t.shift()),q.html(i)},hideMessages:function(){q.html("")}},N=l.find(".yith-wcbk-booking-start-date-time"),t=l.closest(yith_booking_form_params.dom.product_container).find(yith_booking_form_params.dom.price),O="yes"!==yith_booking_form_params.price_first_only?t:t.first(),z=l.closest("form").find("button[type=submit]"),B=D(".add-request-quote-button").first(),P={message:bk.loader_svg,blockMsgClass:"yith-wcbk-block-ui-element",css:{border:"none",background:"transparent"},overlayCSS:{background:"#fff",opacity:.7},ignoreIfBlocked:!0},T={message:null,overlayCSS:{opacity:0},ignoreIfBlocked:!0},J=function(t,i,e){return isNaN(t)&&(t=0),t<2?i:e},Q=null;z.attr("disabled",!0),B.addClass("disabled"),l.on("yith_wcbk_booking_form_update",function(){var t,e,i,o=u.val(),a=p.val(),n=C.val(),r=n,s=j.val(),_=0,m=N.val(),c="",d=!0,h={};0<S.length&&(m?S.val(n+" "+m):S.val(n),r=S.val()),w?y.each(function(){_+=D(this).val()<1?0:parseInt(D(this).val())}):_=a<1?0:parseInt(a),!o&&k&&(c+=yith_booking_form_params.i18n_empty_duration+"<br />",d=!1),(!n||0<j.length&&!s)&&("yes"===yith_booking_form_params.show_empty_date_time_messages&&(c+=f?yith_booking_form_params.i18n_empty_date_for_time+"<br />":yith_booking_form_params.i18n_empty_date+"<br />"),d=!1),f&&n&&!m&&("yes"===yith_booking_form_params.show_empty_date_time_messages&&(c+=yith_booking_form_params.i18n_empty_time+"<br />"),d=!1),_<g.minimum_number_of_people&&(c+=yith_booking_form_params.i18n_min_persons.replace(/%s/g,g.minimum_number_of_people)+"<br />",d=!1),0<g.maximum_number_of_people&&_>g.maximum_number_of_people&&(c+=yith_booking_form_params.i18n_max_persons.replace(/%s/g,g.maximum_number_of_people)+"<br />",d=!1),r&&s&&"day"===g.duration_unit&&(o=yith_wcbk_dates.date_diff(s,r,"days"),"yes"===g.full_day&&(o+=1),0<g.minimum_duration&&o<g.minimum_duration&&(t=J(g.minimum_duration,yith_booking_form_params.i18n_days.singular,yith_booking_form_params.i18n_days.plural).replace(/%s/g,g.minimum_duration),c+=yith_booking_form_params.i18n_min_duration.replace(/%s/g,t)+"<br />",d=!1),0<g.maximum_duration&&o>g.maximum_duration&&(t=J(g.maximum_duration,yith_booking_form_params.i18n_days.singular,yith_booking_form_params.i18n_days.plural).replace(/%s/g,g.maximum_duration),c+=yith_booking_form_params.i18n_max_duration.replace(/%s/g,t)+"<br />",d=!1)),d?(q.block(P),O.block(P),z.block(T),B.block(T),e=[],i=[],w&&y.each(function(){var t=D(this).data("person-type-id"),i=D(this).val();e.push({id:t,number:i})}),x&&v.each(function(){var t;D(this).is(":checked")&&(t=D(this).data("service-id"),i.push(t))}),h={product_id:b,duration:o,from:r,time:m,to:s,persons:a,person_types:e,booking_services:i,action:"yith_wcbk_get_booking_data",context:"frontend"},M.length&&M.each(function(){var t=D(this).attr("name"),i=D(this).val();t.length&&(h[t]=i)}),A.length&&A.each(function(){var t=D(this).attr("name"),i=D(this).val();t.length&&(h[t]=i)}),Q&&Q.abort(),Q=D.ajax({type:"POST",data:h,url:yith_booking_form_params.ajaxurl,success:function(t){try{t.error?F.addMessage('<p class="error">'+t.error+"</p>"):(t.message&&F.addMessage(t.message),t.totals_html?I.html(t.totals_html):I.html(""),t.price&&0<t.price.length&&O.html(t.price),t.is_available?(z.attr("disabled",!1),B.removeClass("disabled")):(z.attr("disabled",!0),B.addClass("disabled")),l.trigger("yith_wcbk_form_update_response",t))}catch(i){console.log(i.message)}},complete:function(t,i){"abort"!==i&&(F.showFirst(),q.unblock(),z.unblock(),B.unblock(),O.unblock())}})):(c&&F.addMessage("<p>"+c+"</p>"),F.hasMessages()?F.showAll():(F.resetMessages(),F.hideMessages()),z.attr("disabled",!0),B.addClass("disabled"))}),l.on("change","input, select, .yith-wcbk-date-picker--inline",function(t){var i=D(t.target),e=u.val(),o=C.val(),a=N.val(),t={};if(f&&o&&e&&(i.is(".yith-wcbk-booking-start-date")||i.is(".yith-wcbk-booking-duration")))return N.parent().block(P),t={product_id:b,duration:e,from:o,action:"yith_wcbk_get_booking_available_times",context:"frontend"},Q&&Q.abort(),Q=D.ajax({type:"POST",data:t,url:yith_booking_form_params.ajaxurl,success:function(t){try{var i;t.error?F.addMessage('<p class="error">'+t.error+"</p>"):(t.time_data_html&&N.html(t.time_data_html),!a||(i=N.find('option[value="'+a+'"]'))&&i.attr("selected","selected"),t.message&&F.addMessage("<p>"+t.message+"</p>"),l.trigger("yith_wcbk_form_update_time",t))}catch(e){console.log(e)}},complete:function(){N.parent().unblock(),l.trigger("yith_wcbk_booking_form_update")}}),!1;l.trigger("yith_wcbk_booking_form_update")}),l.on("yith_wcbk_booking_form_loaded",function(){0<C.val().length?C.trigger("change"):"yes"===yith_booking_form_params.update_form_on_load&&l.trigger("yith_wcbk_booking_form_update")}),!yith_booking_form_params.is_admin&&"yes"===yith_booking_form_params.ajax_update_non_available_dates_on_load&&C.is(".yith-wcbk-date-picker")?(C.parent().block(P),C.trigger("yith_wcbk_datepicker_load_non_available_dates",{callback:function(){C.parent().unblock(),l.trigger("yith_wcbk_booking_form_loaded")}})):l.trigger("yith_wcbk_booking_form_loaded")},D(document).on("yith-wcbk-init-booking-form",function(){var t=D(".yith-wcbk-date-picker"),i=D(".yith-wcbk-booking-form"),e=D(".yith-wcbk-people-selector"),o=D(".yith-wcbk-month-picker-wrapper");t.yith_wcbk_datepicker(),o.yith_wcbk_monthpicker(),e.each(function(){D(this).yith_wcbk_people_selector()}),i.each(function(){D(this).yith_booking_form()}),D(document).trigger("yith-wcbk-booking-form-loaded")}).trigger("yith-wcbk-init-booking-form"),D(document).on("qv_loader_stop",function(){D(document).trigger("yith-wcbk-init-booking-form")})});