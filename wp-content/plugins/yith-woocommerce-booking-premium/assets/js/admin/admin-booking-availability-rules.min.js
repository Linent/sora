jQuery(function(o){"use strict";var c={lastIndex:1,rulesContainer:!1,rulesList:!1,hasTime:!1,preNewRuleContainer:o("#yith-wcbk-availability-rules__pre-new-rule"),expandCollapseButton:o(".yith-wcbk-availability-rules__expand-collapse"),saveSettingsButton:o("#yith-wcbk-settings-tab-actions-save"),init:function(){this._initParams(),o(document).on("yith_wcbk_booking_product_duration_unit_changed",this.updateHasTime),o(document).on("click yith_wcbk_admin_booking_availability_rule_type_change",".yith-wcbk-availability-rule__type",this.changeFromToFieldsByType),o(".yith-wcbk-availability-rules__new-rule").on("click",this.preAddRule),this.preNewRuleContainer.on("click",".yith-wcbk-availability-rules__add-rule",this.addRule),o(document).on("click",".yith-wcbk-availability-rules__delete-rule",this.deleteRule),o("form#post, form#yith-wcbk-global-availability").on("submit",this.emptyPreAddRule),this.expandCollapseButton.on("click",this.expandCollapseAll),o(document).on("click",".yith-wcbk-availability-rule__days-enabled, .yith-wcbk-availability-rule__times-enabled",function(i){c.checkFieldVisibility(o(i.target))}),this.initAllRulesVisibility(),this.expandCollapseVisibility()},_initParams:function(){this.rulesContainer=o(".yith-wcbk-availability-rules").first(),this.rulesList=this.rulesContainer.find(".yith-wcbk-availability-rules__list"),this.lastIndex=this.rulesList.find(".yith-wcbk-availability-rule").length||0},initAllRulesVisibility:function(){o(".yith-wcbk-availability-rule").each(function(){c.checkFieldVisibility(o(this))})},nextIndex:function(){return++c.lastIndex},updateHasTime:function(i,e){c.hasTime=e.has_time||!1,c.initAllRulesVisibility()},changeFromToFieldsByType:function(i){var e=o(i.target).parent(),t=e.find("input[type=radio]:checked").val()||"month",i=e.closest(".yith-wcbk-availability-rule").find(".yith-wcbk-availability-rule__from-to-row"),e=i.find(".yith-wcbk-month-range-select"),i=i.find(".yith-wcbk-admin-date-picker");"custom"===t?(i.removeAttr("disabled"),e.attr("disabled","disabled"),i.parent().show()):(e.removeAttr("disabled"),i.attr("disabled","disabled"),i.parent().hide())},getRuleToAdd:function(){var i=c.preNewRuleContainer.find(".yith-wcbk-availability-rule").first();return!!i.length&&i},emptyPreAddRule:function(){c.preNewRuleContainer.html("")},preAddRule:function(i){i.preventDefault();var e,t,l=o(i.target);c.getRuleToAdd()?c.preNewRuleContainer.is(".bk--open")?c.preNewRuleContainer.removeClass("bk--open").slideUp():c.preNewRuleContainer.addClass("bk--open").slideDown():(t=l.data("template"),i=c.nextIndex(),c.preNewRuleContainer.hide(),t=t.replace(new RegExp("{{INDEX}}","g"),i),t=o(t),c.preNewRuleContainer.append(t),t.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),c.checkFieldVisibility(t),c.preNewRuleContainer.addClass("bk--open").slideDown()),c.preNewRuleContainer.is(".bk--open")&&(e=l.offset())&&e.top&&o("html, body").animate({scrollTop:e.top-l.outerHeight()-20})},addRule:function(i){i.preventDefault();i=o(this).closest(".yith-wcbk-availability-rule");i.find(".yith-wcbk-availability-rules__add-rule").remove(),c.rulesList.append(i),c.expandCollapseVisibility(),c.attentionForSaving()},deleteRule:function(i){i.preventDefault(),o(i.target).closest(".yith-wcbk-availability-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){o(this).remove(),c.expandCollapseVisibility(),c.attentionForSaving()})},checkFieldVisibility:function(i){var e,t,l,a,n,s=o(i).closest(".yith-wcbk-availability-rule");s.length&&(e=s.find(".yith-wcbk-availability-rule__days-enabled"),l=(t=s.find(".yith-wcbk-availability-rule__times-enabled")).closest(".yith-wcbk-form-field__container"),a=s.find(".yith-wcbk-availability-rule__bookable-row"),n=s.find(".yith-wcbk-availability-rule__day"),i=s.find(".yith-wcbk-availability-rule__day-time"),e.is(":checked")?(a.hide(),n.show()):(a.show(),n.hide()),e.is(":checked")&&c.hasTime?l.show():l.hide(),e.is(":checked")&&c.hasTime&&t.length&&t.is(":checked")?i.show():i.hide(),s.find(".yith-wcbk-availability-rule__type").trigger("yith_wcbk_admin_booking_availability_rule_type_change"))},expandCollapseAll:function(i){var e=o(i.target).closest(".yith-wcbk-availability-rules__expand-collapse"),i=c.rulesList;e.is(".yith-wcbk-availability-rules__expand-collapse--collapse")?(e.removeClass("yith-wcbk-availability-rules__expand-collapse--collapse"),i.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle").click()):(e.addClass("yith-wcbk-availability-rules__expand-collapse--collapse"),i.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle").click())},expandCollapseVisibility:function(){c.rulesList.find(".yith-wcbk-availability-rule").length?c.expandCollapseButton.show():c.expandCollapseButton.hide()},attentionForSaving:function(){c.saveSettingsButton.length&&(c.saveSettingsButton.removeClass("yith-wcbk-effect--wiggle"),c.saveSettingsButton.outerWidth(),c.saveSettingsButton.addClass("yith-wcbk-effect--wiggle"))}};c.init()});